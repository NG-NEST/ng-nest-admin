<div class="app-inner">
  <div class="app-left">
    <form class="form" [formGroup]="form">
      <div class="item">
        <x-tree-select
          formControlName="category"
          [placeholder]="'请选择一个代码分类'"
          [data]="categories()"
          expandedLevel="3"
          showPath
        ></x-tree-select>
        <x-button
          icon="fto-plus"
          [disabled]="!form.value.category"
          type="primary"
          (click)="action($event, 'add-root')"
          text
          >添加根节点</x-button
        >
      </div>
    </form>
    <div class="catalogue" [x-loading]="treeLoading()">
      <x-tree
        #treeCom
        [data]="treeData()"
        [labelTpl]="treeNode"
        showLine
        expandedLevel="0"
        (nodeClick)="onNodeClick($event)"
      >
      </x-tree>
      <ng-template #treeNode let-node="$node">
        <div class="tree-node">
          <div class="label">
            @if (node.type === 'Folder') {
              @if (node.open) {
                <x-icon type="admin:folder-open"></x-icon>
              } @else {
                <x-icon type="admin:folder"></x-icon>
              }
            } @else if (node.type === 'File') {
              <x-icon [type]="node.label | appFileIcon"></x-icon>
            }
            <span>{{ node.label }}</span>
          </div>
          <div class="actions">
            @if (node.type === 'Folder') {
              <x-link
                type="primary"
                icon="fto-plus-square"
                (click)="action($event, 'add-child', node)"
              ></x-link>
            }
            <x-link type="primary" icon="fto-edit" (click)="action($event, 'edit', node)"></x-link>
            <x-link
              type="danger"
              icon="fto-minus-square"
              (click)="action($event, 'delete', node)"
            ></x-link>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
  <form
    class="app-right"
    [formGroup]="editorForm"
    (ngSubmit)="saveContent()"
    [x-loading]="saveContentLoading()"
    background="rgba(0,0,0,0.4)"
    color="rgba(170,170,170,1)"
  >
    <app-editor formControlName="content" [filename]="filename()"></app-editor>
    <div class="bottom-buttons">
      <x-button
        flat
        icon="fto-save"
        type="primary"
        attrType="submit"
        [loading]="saveContentLoading()"
        [disabled]="!form.valid"
        >保存</x-button
      >
    </div>
  </form>
</div>
