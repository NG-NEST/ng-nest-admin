<form [formGroup]="form()" class="app-dialog-form" (ngSubmit)="save()">
  <h4 x-dialog-title class="title">{{ title() }}</h4>
  <x-button
    class="close"
    icon="fto-x"
    size="large"
    flat
    text
    (click)="dialogRef!.close()"
  ></x-button>
  <div x-dialog-content class="content full">
    @if (steps().length === 1) {
      <div class="form-title">
        <h4>{{ steps()[0].label }}</h4>
        <span>{{ steps()[0].description }}</span>
      </div>
    } @else {
      <x-steps [data]="steps()" [activatedIndex]="stepIndex()"> </x-steps>
    }
    <x-tabs [activatedIndex]="stepIndex()" sliderHidden>
      @for (item of formList(); track item.variableId) {
        <x-tab>
          <div class="form">
            <x-button class="select-data" type="primary" text (click)="onSelectData(item)">
              {{ '$codeGenerate.selectData' | xI18n }}
            </x-button>
            <app-schema-form
              #schemaForm
              [data]="item.jsonSchema"
              [form]="getForm(item.variableId)"
            ></app-schema-form>
          </div>
        </x-tab>
      }
    </x-tabs>
  </div>
  <div x-dialog-actions align="center" class="actions">
    <x-button icon="fto-x" attrType="button" flat plain x-dialog-close>{{
      '$base.cancel' | xI18n
    }}</x-button>
    @if (stepIndex() > 0) {
      <x-button attrType="button" (click)="pre()" flat plain>{{
        '$base.previous' | xI18n
      }}</x-button>
    }
    @if (stepIndex() < formList().length - 1) {
      <x-button attrType="button" (click)="next()" [disabled]="nextDisabled" flat plain>{{
        '$base.next' | xI18n
      }}</x-button>
    }
    @if (stepIndex() === formList().length - 1) {
      <x-button
        flat
        icon="fto-save"
        type="primary"
        attrType="submit"
        [loading]="saveLoading()"
        [disabled]="!form().valid"
        >{{ '$base.submit' | xI18n }}</x-button
      >
    }
  </div>
</form>
