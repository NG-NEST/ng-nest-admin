<form [x-loading]="formLoading()" [formGroup]="form" class="app-dialog-form" (ngSubmit)="save()">
  <h4 x-dialog-title class="title">环境变量</h4>
  <x-button x-dialog-close class="close" icon="fto-x" size="large" flat text></x-button>
  <div x-dialog-content class="content attrs">
    <div class="query">
      <div class="item">
        <label>资源分类：</label>
        <x-select
          formControlName="variableCategoryId"
          (ngModelChange)="variableCategoryChange($event)"
          [data]="variableCategorys()"
          placeholder="请选择一个变量分类"
          [clearable]="false"
        ></x-select>
      </div>
    </div>
    <div class="tools">
      <x-button icon="fto-plus" attrType="button" flat plain (click)="add()">增加</x-button>
    </div>
    <div class="attrs-table">
      <table>
        <thead>
          <tr>
            <th>序号</th>
            <th width="160">变量名</th>
            <th width="160">数据类型</th>
            <th width="160">值</th>
            <th width="200">说明</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody formArrayName="global">
          @for (item of global.controls; track item) {
            <tr [formGroupName]="$index">
              <td class="index">{{ $index + 1 }}</td>
              <td><x-input formControlName="code"></x-input></td>
              <td>
                <x-input formControlName="type"></x-input>
              </td>
              <td>
                <x-input formControlName="value"></x-input>
              </td>
              <td><x-input formControlName="description"></x-input></td>
              <td>
                <x-button icon="fto-trash-2" attrType="button" flat plain (click)="remove($index)">
                  删除
                </x-button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  <div x-dialog-actions align="center" class="actions">
    <x-button icon="fto-x" attrType="button" flat plain x-dialog-close>取消</x-button>
    <x-button
      flat
      icon="fto-save"
      type="primary"
      attrType="submit"
      [loading]="saveLoading()"
      [disabled]="!form.valid"
      >保存</x-button
    >
  </div>
</form>
